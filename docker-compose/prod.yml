services:
  web:
    extends:
      file: base.yml
      service: web
    volumes:
      - static:/app/staticfiles
      - media:/app/media
    restart: always

  proxy:
    image: nginx:latest
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./certbot/www:/var/www/certbot/:ro
      - ./certbot/conf:/etc/nginx/ssl/:ro
      - static:/static:ro
      - media:/media:ro
    depends_on:
      - web
    restart: always

  certbot:
    image: certbot/certbot:latest
    profiles: ["certbot"]
    volumes:
      - ./certbot/www:/var/www/certbot/:rw
      - ./certbot/conf:/etc/letsencrypt/:rw

  db:
    extends:
      file: base.yml
      service: db
    restart: always

  mjml:
    extends:
      file: base.yml
      service: mjml
    restart: always

  memcached:
    extends:
      file: base.yml
      service: memcached
    restart: always

volumes:
   postgres_data:
   static:
   media:
